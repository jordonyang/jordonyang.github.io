<!DOCTYPE html>
<html lang="zh_CN">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    
        <meta name="twitter:card" content="summary"/>
    



<meta name="twitter:title" content="Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern"/>
<meta name="twitter:description" content="WordCounter - 基于责任链设计模式的代码文件分析统计器"/>
<meta name="twitter:site" content="@"/>



  	<meta property="og:title" content="Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern &middot; 临风博客" />
  	<meta property="og:site_name" content="临风博客" />
  	<meta property="og:url" content="https://jordonyang.github.io/post/code-file-analyser-and-counter-based-on-chain-of-responsibility-disgn-pattern/" />

    
        
            <meta property="og:image" content="https://www.bing.com/ImageResolution.aspx?w=1366&h=768"/>
        
    

    
    <meta property="og:description" content="WordCounter - 基于责任链设计模式的代码文件分析统计器" />
  	<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2018-09-14T12:23:56&#43;08:00" />

    
    <meta property="article:tag" content="Java" />
    
    <meta property="article:tag" content="design pattern" />
    
    

    <title>Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern &middot; 临风博客</title>

    
    <meta name="description" content="WordCounter - 基于责任链设计模式的代码文件分析统计器" />
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://www.easyicon.net/api/resizeApi.php?id=1155590&size=64">

    <link rel="stylesheet" type="text/css" href="https://jordonyang.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="https://jordonyang.github.io/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="https://jordonyang.github.io/css/hugo.css" />
    
    
    <script>
	  	 var _hmt = _hmt || [];
	     (function() {
	         var hm = document.createElement("script");
	         hm.src = "https://hm.baidu.com/hm.js?443ffc2fb7ecc22f8d3126f86579cc93";
	         var s = document.getElementsByTagName("script")[0]; 
	         s.parentNode.insertBefore(hm, s);
	    })();
   </script>

    

    
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/github-gist.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
        
        <script>hljs.initHighlightingOnLoad();</script>
    

    
      
          <link href="https://jordonyang.github.io/index.xml" rel="alternate" type="application/rss+xml" title="临风博客" />
      
      
    
    <meta name="generator" content="Hugo 0.47.1" />

    <link rel="canonical" href="https://jordonyang.github.io/post/code-file-analyser-and-counter-based-on-chain-of-responsibility-disgn-pattern/" />

    
      
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": ,
        "logo": https://jordonyang.github.io/images/logo.jpg
    },
    "author": {
        "@type": "Person",
        "name": ,
        
        "image": {
            "@type": "ImageObject",
            "url": https://jordonyang.github.io/images/logo.jpg,
            "width": 250,
            "height": 250
        }, 
        
        "url": https://jordonyang.github.io/,
        "sameAs": [
            
            
             
             
             
             
             
            
        ]
    },
    "headline": Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern,
    "name": Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern,
    "wordCount": 286,
    "timeRequired": "PT2M",
    "inLanguage": {
      "@type": "Language",
      "alternateName": en
    },
    "url": https://jordonyang.github.io/post/code-file-analyser-and-counter-based-on-chain-of-responsibility-disgn-pattern/,
    "datePublished": 2018-09-14T12:23Z,
    "dateModified": 2018-09-14T12:23Z,
    
    "keywords": Java, design pattern,
    "description": WordCounter - 基于责任链设计模式的代码文件分析统计器,
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": https://jordonyang.github.io/post/code-file-analyser-and-counter-based-on-chain-of-responsibility-disgn-pattern/
    }
}
    </script>
    


    

    
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script> 

    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">临风博客</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordonyang.github.io/">首页</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordonyang.github.io/tags/">标签</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordonyang.github.io/categories/">分类</a>
            </li>
        
            
            <li class="nav-opened" role="presentation">
            	<a href="https://jordonyang.github.io/about">关于我</a>
            </li>
        
            </br></br><strong>学习大纲</strong>
            <li class="nav-opened" role="presentation">
            	<a href="https://jordonyang.github.io/hierarchy-java">Java</a>
            </li>
        
        
    </ul>

    
    <a class="subscribe-button icon-feed" href="https://jordonyang.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">



  <header class="main-header post-head" style="background-image: url(https://www.bing.com/ImageResolution.aspx?w=1366&amp;h=768)">

<nav class="main-nav overlay clearfix">

  
      <a class="blog-logo" href="https://jordonyang.github.io/"><img src="https://jordonyang.github.io/images/logo.jpg" alt="Home" /></a>
  
  
      <a class="menu-button" href="#"><span class="burger">&#9776;</span><span class="word">Menu</span></a>
  
  </nav>
  
  <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern</h1>
            <br>
            


    <a class="bloglogo" href="https://github.com/jordonyang" target="_blank">
    <span class="icon-github" style="color:white;font-size:2em"></span>
    </a>
&nbsp;






















        </div>
    </div>
</header>



<main class="content" role="main">

  <article class="post post">
    
    <header class="post-header">
        <h1 class="post-title">Code File Analyser and Counter Based on Chain of Responsibility Disgn Pattern</h1>
        <em style="color: blue">WordCounter - 基于责任链设计模式的代码文件分析统计器</em>

        <section class="post-meta">
        
          
          <span class="post-tag small"><a href="https://jordonyang.github.io//tags/java/">#Java</a></span> &nbsp; &nbsp;  
         
          <span class="post-tag small"><a href="https://jordonyang.github.io//tags/design-pattern/">#design pattern</a></span> &nbsp; &nbsp;  
         
        

          <time class="post-date" datetime="2018-09-14T12:23:56&#43;08:00">
            2018/Sep/14
          </time>

        
         </section>
    </header>
      <br>
    <section class="post-content">
      

<p><a href="https://github.com/jordonyang/WordCounter">Github仓库地址</a></p>

<p><strong>前言</strong> ： 该项目是学校软件工程课程的一个小作业，要求大概是分析统计代码文件中的一些数据（如行数、词数、注释行数、代码行数、字符数等），下面简单介绍下我的完成情况。</p>

<h2 id="一-psp2-1表格">一. PSP2.1表格</h2>

<table>
<thead>
<tr>
<th><strong>PSP2.1</strong></th>
<th><strong>Personal Software Process Stages</strong></th>
<th><strong>预估耗时（分钟）</strong></th>
<th><strong>实际耗时（分钟）</strong></th>
</tr>
</thead>

<tbody>
<tr>
<td>Planning</td>
<td>计划</td>
<td>20</td>
<td>35</td>
</tr>

<tr>
<td>· Estimate</td>
<td>· 估计这个任务需要多少时间</td>
<td>20</td>
<td>35</td>
</tr>

<tr>
<td>Development</td>
<td>开发</td>
<td>460</td>
<td>842</td>
</tr>

<tr>
<td>· Analysis</td>
<td>· 需求分析 (包括学习新技术)</td>
<td>100</td>
<td>221</td>
</tr>

<tr>
<td>· Design Spec</td>
<td>· 生成设计文档</td>
<td>30</td>
<td>41</td>
</tr>

<tr>
<td>· Design Review</td>
<td>· 设计复审 (和同事审核设计文档)</td>
<td>20</td>
<td>38</td>
</tr>

<tr>
<td>· Coding Standard</td>
<td>· 代码规范 (为目前的开发制定合适的规范)</td>
<td>30</td>
<td>39</td>
</tr>

<tr>
<td>· Design</td>
<td>· 具体设计</td>
<td>30</td>
<td>54</td>
</tr>

<tr>
<td>· Coding</td>
<td>· 具体编码</td>
<td>200</td>
<td>367</td>
</tr>

<tr>
<td>· Code Review</td>
<td>· 代码复审</td>
<td>20</td>
<td>38</td>
</tr>

<tr>
<td>· Test</td>
<td>· 测试（自我测试，修改代码，提交修改）</td>
<td>30</td>
<td>44</td>
</tr>

<tr>
<td>Reporting</td>
<td>报告</td>
<td>130</td>
<td>43</td>
</tr>

<tr>
<td>· Test Report</td>
<td>· 测试报告</td>
<td>60</td>
<td>128</td>
</tr>

<tr>
<td>· Size Measurement</td>
<td>· 计算工作量</td>
<td>40</td>
<td>51</td>
</tr>

<tr>
<td>· Postmortem &amp; Process Improvement Plan</td>
<td>· 事后总结, 并提出过程改进计划</td>
<td>30</td>
<td>46</td>
</tr>

<tr>
<td>合计</td>
<td></td>
<td>610</td>
<td>920</td>
</tr>
</tbody>
</table>

<h2 id="二-解题思路">二. 解题思路</h2>

<p>根据题意，可以将输入参数分为两类，一类是可选的操作参数，一类是文件路径或者与文件相关的匹配模式；而操作参数有分为两类，一类是用于进行分析计数的（-a, -l, -w, -c），另一类则是用于获取被分析对象的（-x, -s）。</p>

<p>对于分析计数的参数， 它们的处理的对象和步骤是一样的，而且处理细节也比较接近，所以可以考虑将它们抽象成一系列的处理器，但是如果对于同一个待处理对象，将不同处理器对它的处理操作设计成并行独立的话，那么显然将增加多余的IO操作的成本，因为不管有多少个分析计数的参数，被处理的文件只需加载进主存一次就够了，因此我参考责任链设计模式将各个处理器的操作设计成了串行的。</p>

<p>这样看来，本项目大体上可以分为三步:</p>

<ul>
<li>获取处理器链</li>
<li>获取待处理的文件集</li>
<li>将文件逐个扔给处理器链处理</li>
</ul>

<h2 id="三-设计实现过程及代码说明">三. 设计实现过程及代码说明</h2>

<h3 id="1-处理器设计">1. 处理器设计</h3>

<p>​   先通过IDEA类图视觉来看一下处理器继承体系</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/H.png" alt="img" /></p>

<p>在<code>BaseProcessor</code>中定义了一套处理文本内容的操作，子类处理器只需要重写父类的方法，对处理对象进行不同的信息分析和提取即可，结合枚举类<code>Arguments</code> 可以看到各个处理器与参数的联系，</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/args1.png" alt="img" /></p>

<p>留意到我将负责参数分析统计的处理器设置成了枚举类的成员属性，这样做的是为了利用枚举类<code>单例属性</code>的的特点实现对处理器对象的复用，而这在避免浪费Java堆内存空间和GC收集的时间的同时也带来了不便，即每处理完一个文件都需要将处理器用于统计的属性值还原到默认值，这一处理细节将在各个处理器的<code>resetValue</code> 方法中体现。</p>

<p>处理器主体方法功能介绍</p>

<ul>
<li>process(String line): 以行为单位进行分析处理</li>
<li>printInfo():  打印处理结果</li>
<li>resetValue(): 对处理器中用于统计或者状态标记的成员属性的值进行还原，为处理下一个文件做准备</li>
</ul>

<h3 id="2-获取责任链">2. 获取责任链</h3>

<h4 id="1-baseprocessor的设计">( 1 ) BaseProcessor的设计</h4>

<p>讲述如何实现获取处理链之前有必要先介绍<code>BaseProcessor</code> 的成员</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/bp.png" alt="img" /></p>

<p>不难发现，一条处理链实际上就是一条<code>BaseProcessor</code> 类型的链表，由于Java继承和多态的支持，表中可以存放任何<code>BaseProcessor</code> 子类对象，每个处理器只需在执行完自己对被读取数据的解析和提取后将该数据交付给自己的下一个结点处理即可。</p>

<h4 id="2-参数解析">( 2 ) 参数解析</h4>

<p>由于处理器是跟表示分析统计操作的参数一一对应的，所以要构造一条处理器责任链需要先进行参数解析</p>

<p>首先看入口程序，大概地对参数做一些判断，当输入格式正常的时候去调用<code>ArgsPaser</code>的<code>parse</code>方法</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/ae.png" alt="ae" /></p>

<p>解析的大概过程</p>

<ul>
<li>在<code>argesMatcher</code> 中定义枚举类与参数的映射规则</li>
<li>判断是否含有<code>-x</code> 参数，确定遍历参数数组的范围

<ul>
<li>有，说明文件通过选择器获得，参数数组的最后一个元素为有效地操作参数，而不是文件路径或匹配规则</li>
<li>无，最后一个参数为文件路径或匹配规则，在获取处理器的时候可以忽略</li>
</ul></li>
<li>遍历参数数组，通过<code>argesMatcher</code> 获取枚举类中定义的单例处理器对象</li>
<li>通过改变处理器对象内部的引用指向，将各个处理器按序连成一条链表</li>
<li>返回处理链的头结点</li>
</ul>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/parser.png" alt="img" /></p>

<h3 id="3-获取待处理对象">3. 获取待处理对象</h3>

<p>获取待处理对象的方式有两种，一是<code>-x</code>参数对应的打开文件选择器直接选择文件，二是<code>-s</code> 参数对应的通过模式递归匹配某个目录下的所有文件，逻辑已经封装进了<code>FileLocator</code> 中，</p>

<h4 id="1-判断在上面的-argparser-中的参数数组中是否含有-s-参数">( 1 ) 判断在上面的<code>ArgParser</code> 中的参数数组中是否含有<code>-s</code> 参数</h4>

<ul>
<li>有， <code>needRecursion</code> 为真，<code>pattern</code> 表示匹配模式，需要递归某个目录进行匹配查找</li>
<li>无，  <code>needRecursion</code> 为假，<code>pattern</code> 表示单个文件的路径</li>
</ul>

<p>​                 <img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/locateFile.png" alt="img" /></p>

<h4 id="2-递归查找">( 2 ) 递归查找</h4>

<ul>
<li>确定进行递归的目录

<ul>
<li>若<code>pattern</code> 为 <code>*.java</code> 或<code>?vm.c</code> 的形式，则从当前<code>exe</code> 执行的目录进行递归</li>
<li>若<code>pattern</code> 为 <code>/usr/local/java/*.java</code> 的形式，则从<code>/usr/local/java/</code> 进行递归</li>
</ul></li>
</ul>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/getfiles.png" alt="img" /></p>

<h4 id="3-通过文件选择器">( 3 ) 通过文件选择器</h4>

<p>好久没用<code>Java GUI</code> ，也懒得去调样式了，此处的界面只做了简单的文件选择（支持多选）功能，获取到的文件集处理完仍然通过控制台打印</p>

<p>​                         <img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/file-choose.png" alt="img" /></p>

<h3 id="4-中间代理">4. 中间代理</h3>

<p>相当于是一个代理， 将需要处理的文件以行为单位读取，然后扔给责任链的头结点进行处理，之前已经提过，头结点处理完之后会将该字符串交付给它的后继结点去处理</p>

<p>​                  <img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/liner.png" alt="img" /></p>

<p>处理完之后，相应的统计结果已经存放在处理器中，打印即可，需要注意的是一定要进行<code>resetValue</code>操作，不然前一个文件的处理结果会影响后一个文件的处理结果，此过程大概流程如下图所示</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/process.png" alt="img" /></p>

<h3 id="5-责任链工作">5. 责任链工作</h3>

<h4 id="1-字符和行数处理器">( 1 ) 字符和行数处理器</h4>

<p>这两个处理器的处理逻辑相似，都是对读进来的每一行进行行数或者字符的统计，逻辑非常简单，不多说。</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/cov1.png" alt="img" /></p>

<h4 id="2-单词处理器">( 2 ) 单词处理器</h4>

<p>大体的过程：</p>

<ul>
<li>对非单词字符进行过滤，通过分割获得单词数组</li>
<li>用<code>map</code> 记录每个单词出现的次数</li>
</ul>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/wp.png" alt="img" /></p>

<h4 id="3-注释-代码行-空行处理器">( 3 ) 注释、代码行、空行处理器</h4>

<p>用<code>annotationOn</code> 标记注释块的开始， 注意第二个跟第三个判断是不能调换的，不然将没法标记注释块的结束。</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/ap.png" alt="img" /></p>

<h2 id="四-测试运行">四. 测试运行</h2>

<h3 id="1-命令行运行效果">1. 命令行运行效果</h3>

<h4 id="1-单文件测试样例">( 1 ) 单文件测试样例</h4>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/sample.png" alt="img" /></p>

<p>参数非法时的运行效果</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/wroingargs.png" alt="img" /></p>

<p>单个参数正确时的运行效果</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/rightargs.png" alt="img" /></p>

<p>对于单个文件的多参数操作</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/multiargs.png" alt="img" /></p>

<h4 id="2-多文件测试样例">( 2 ) 多文件测试样例</h4>

<p>通过文件选择器选择带操作对象</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/xargs.png" alt="img" /></p>

<p>支持类似<code>Linux shell script</code> 的简单文件名模式匹配</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/pattern1.png" alt="img" /></p>

<h3 id="2-单元测试">2. 单元测试</h3>

<p>使用<code>Junit</code> 进行单元测试对项目进行测试，具体的测试代码见 <a href="https://github.com/jordonyang/WordCounter/blob/master/src/test/java/github/jordon/AppEntryTest.java">AppEnrtTest.java</a>, 测试用例可以再<code>samples</code> 文件夹中找到</p>

<h3 id="3-代码覆盖率">3. 代码覆盖率</h3>

<p>使用<code>org.macen.jacoco</code>  插件对测试代码的分支覆盖率、项目类数、方法数等信息进行分析统计，统计记过如图所示，原测试报告压缩包可以在工程目录下的<code>results</code>中找到。</p>

<p><img src="https://github.com/jordonyang/WordCounter/raw/master/imgs/cov.png" alt="img" /></p>

<h2 id="五-项目小结">五. 项目小结</h2>

<ul>
<li>收获最大在于系统设计，感觉设计模式真的是一种很神奇的东西，对于同一个问题，一个好的设计模式帮助开发人员写出更加优雅而高效的代码</li>
<li>通过代码覆盖率对测试有了更加深刻的认识，在<code>Cov</code> 逐渐接近100%的过程中，每个分支丢失的比率会不停下降，在开发过程中关注代码覆盖率将有助于把测试范围覆盖到所有的需要作出判断情况，有助于对系统健壮性的增强。</li>
<li>通过<code>PSP</code> 对软件工程开发流程有了更深刻的认识，先谋而后动、每一步都细化和量化的开发习惯不但利于提升效率，还有助于系统的整体性把控及日后问题的定位。</li>
</ul>

<pre><code>作者：jordonyang
出处：http://geekeye.cc/post/code-file-analyser-and-counter-based-on-chain-of-responsibility-disgn-pattern/
本文版权归作者所有，欢迎转载，但未经作者同意必须在文章页面给出原文连接，否则保留追究法律责任的权利。
</code></pre>

    </section>

  <footer class="post-footer">
    








<figure class="author-image">
    <a class="img" href="https://jordonyang.github.io/" style="background-image: url(/images/logo.jpg)"><span class="hidden">临风's Picture</span></a>
</figure>


<section class="author">
  <div class="author-meta">
    <span>                                         </span> 
    <span class="author-location icon-location">Java, Security developer</span>
    <span class="author-link icon-link"><a href="https://jordonyang.github.io/">https://jordonyang.github.io/</a></span>
    <span class="author-location icon-location">Guangzhou, China</span>
    <span class="author-profile" style="width:100%;line-height:1.5em;">本站所有文章如未说明均为原创，请勿随意转载，如需转载请联系我 (<a href="mailto:hujiawei090807@gmail.com">linfengit@qq.com</a>)</span>
  </div>
</section>



  	
  	
<aside class="read-next">

      
      <span class="readmore-prev readmore-meta">PREV: <a href="https://jordonyang.github.io/post/arithmetic-expression-generator-based-on-binary-tree-structure/"><h4>An Arithmetic Expression Generator Based on Binary Tree Structure</h4></a></span>
      </a>
     

     
 
     <span class="readmore-next readmore-meta">NEXT: <a href="https://jordonyang.github.io/post/digging-in-sourse-of-hashmap-jdk1.7/"><h4>Digging in Source Code of HashMap (JDK1.7)</h4></a></span>
  

</aside>




    




    
    
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNjU2My8xMzA5OA==">
<script type="text/javascript">
   (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];

       if (typeof LivereTower === 'function') { return; }

       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;

       e.parentNode.insertBefore(j, e);
   })(document, 'script');
</script>
<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
</div>

    
  </footer>
</article>



	
</main>

    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">临风博客</a> All rights reserved</section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="https://jordonyang.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="https://jordonyang.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://jordonyang.github.io/js/index.js"></script>
    
</body>
</html>

